lib996:include("Script/serialize.lua")
local cfg_huiyuan = {
    var = {
        cur_VIP = "VIP_当前会员等级",
        mon_number = "VIP_当前杀怪数量",
    },
    msg = {
        chenggong = '{"Msg":"<font color=\'#ff0000\'>升级成功！</font>","Type":9}',
    },
    id = 309,
    [1] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 1%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 1
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [2] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 2%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 2
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [3] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 3%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 3
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [4] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 4%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 4
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [5] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 5%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 5
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [6] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 6%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 6
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [7] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 7%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 7
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [8] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 8%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 8
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
    [9] ={
        miaoshu = "<font color='#01d1ff'>打宝概率提升 9%<br>装备回收比例提升5%<br>对怪每秒伤害提升960</font>",
        jiangli = {
            [1] = {
                [1] = 10014,
                [2] = 9
            },
            [2] = {
                [1] = 10014,
                [2] = 5
            },
            [3] = {
                [1] = 10014,
                [2] = 10
            },
            [4] = {
                [1] = 10014,
                [2] = 50
            },
            [5] = {
                [1] = 10014,
                [2] = 100
            },
        }
    },
}
local cfg_renwu = {
    [1] = {
        ---1 转生等级任务 2 杀怪任务 3 装备任务 4 等级任务
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            level = 50,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            level = 10,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [2] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [3] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [4] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [5] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [6] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [7] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [8] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            type = "level",
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    },
    [9] = {
        [1] = {
            number = 1,
            renwu = "角色转生等级达到<font color='#01f801'>1转</font>",
        },
        [2] = {
            type = "shaguai",
            number = 100,
            renwu = "击杀<font color='#01f801'>50级</font>及以上怪物<font color='#01f801'>100只</font>",
        },
        [3] = {
            type = "zhuangbei",
            number = 6,
            renwu = "穿戴<font color='#01f801'>6件</font><font color='#01f801'>10阶</font>以上装备",
        },
        [4] = {
            type = "level",
            number = 100,
            renwu = "角色等级达到<font color='#01f801'>100级</font>",
        },
    }
}
function getcfg_mianfeihuiyuan()
    return cfg_huiyuan
end

function mianfeihuiyuan(actor)
    lib996:showformwithcontent(actor, "A/免费会员", "")
end

function SyncResponse(actor)
    --当前VIP等级
    local cur_VIP = lib996:getint(0, actor, cfg_huiyuan.var.cur_VIP)
    ---当前任务完成情况
    local cfg = cfg_renwu[cur_VIP + 1]
    ---1.转生等级任务
    local zhuansheng_level = lib996:getrelevel(actor)
    ---2 杀怪任务
    local mon_number = lib996:getint(0, actor, cfg_huiyuan.var.mon_number)
    ---3 装备任务
    local zhuangbei = 0
    ---4 等级任务
    local level = lib996:getlevel(actor)
    sendList = {}
    table.insert(sendList, cur_VIP)
    table.insert(sendList, zhuansheng_level)
    table.insert(sendList, mon_number)
    table.insert(sendList, zhuangbei)
    table.insert(sendList, level)
    lib996:showformwithcontent(actor, "", "mianfeihuiyuan.SyncResponse(" .. serialize(sendList) .. ")")
end

function shengji(actor)
    local cur_VIP = lib996:getint(0, actor, cfg_huiyuan.var.cur_VIP)
    if cur_VIP >= #cfg_huiyuan then
        return
    end
    --    升级vip等级并给装备
    --1.升级等级
    lib996:setint(0, actor, cfg_huiyuan.var.cur_VIP, cur_VIP + 1)
    lib996:sendmsg(actor,1,cfg_huiyuan.msg.chenggong)
    --2.给奖励
    _Fsendmail(lib996:getbaseinfo(actor, ConstCfg.gbase.name), cfg_huiyuan.id, cfg_huiyuan[cur_VIP + 1].jiangli, "VIP"..(cur_VIP + 1))
    --3.刷新界面
    SyncResponse(actor)
end

---@param index integer 任务id
function finish_renwu(actor, index)
    print(index)
end

--计算杀怪任务
GameEvent.add(EventCfg.onKillMon, function(actor, monobj, monidx)
    local cur_VIP_level = lib996:getint(0, actor, cfg_huiyuan.var.cur_VIP)
    if cur_VIP_level >= #cfg_huiyuan then
        return
    end
    local renwu = cfg_renwu[cur_VIP_level + 1][2]
    if lib996:getbaseinfo(monobj, ConstCfg.gbase.level) >= renwu.level then
        local mon_number = lib996:getint(0, actor, cfg_huiyuan.var.mon_number)
        lib996:setint(0, actor, cfg_huiyuan.var.mon_number, mon_number + 1)
    -- 如果要做任务完成提示可以在这里加一个任务完成变量赋值
    end
    --print("当前杀怪数量",lib996:getint(0, actor, cfg_huiyuan.var.mon_number))
end, "免费会员")

--转生等级任务 等级任务 装备任务 无需记录
